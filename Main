import java.util.Scanner;
import java.util.InputMismatchException;

public class Main {

    private static Scanner scanner = new Scanner(System.in);
    private static TelefonoMovil telefonoMovil = new TelefonoMovil("600000000");

    public static void main(String[] args) {

        boolean sal = false;
        muestraMenu();

        while (!sal) {
            try {
                System.out.print("\nElige una opción (6 para ver menú): ");
                int action = scanner.nextInt();
                scanner.nextLine();

                switch (action) {
                    case 0:
                        System.out.println("Cerrando la agenda...");
                        sal = true;
                        break;

                    case 1:
                        telefonoMovil.printContacts();
                        break;

                    case 2:
                        addNewContact();
                        break;

                    case 3:
                        updateContact();
                        break;

                    case 4:
                        removeContact();
                        break;

                    case 5:
                        queryContact();
                        break;

                    case 6:
                        muestraMenu();
                        break;

                    default:
                        System.out.println("Esa opción no está en la lista.");
                        break;
                }
            } catch (InputMismatchException e) {
                System.out.println("Error,Solo se permiten números del 0 al 6.");
                scanner.nextLine();
            }
        }
    }

    private static void muestraMenu() {
        System.out.println("\n--- MENÚ DE OPCIONES ---");
        System.out.println("0 - Salir");
        System.out.println("1 - Lista de contactos");
        System.out.println("2 - Nuevo contacto");
        System.out.println("3 - Editar contacto");
        System.out.println("4 - Borrar contacto");
        System.out.println("5 - Buscar por nombre");
        System.out.println("6 - Ver opciones otra vez");
    }

    private static void queryContact() {
        System.out.print("Introduce el nombre a buscar: ");
        String nombre = scanner.nextLine();

        Contacto contact = telefonoMovil.queryContact(nombre);
        if (contact == null) {
            System.out.println("No he encontrado a nadie con ese nombre.");
        } else {
            System.out.println("Datos: " + contact.getName() + " -> " + contact.getPhoneNumber());
        }
    }

    private static void updateContact() {
        System.out.print("Nombre de quien quieres actualizar: ");
        String nombre = scanner.nextLine();

        Contacto antContact = telefonoMovil.queryContact(nombre);
        if (antContact == null) {
            System.out.println("Ese contacto no existe en la lista.");
            return;
        }

        System.out.print("Nombre corregido: ");
        String nuevNombre = scanner.nextLine();

        System.out.print("Teléfono nuevo: ");
        String nuevTelefono = scanner.nextLine();

        Contacto nuevContact = Contacto.createContact(nuevNombre, nuevTelefono);

        if (telefonoMovil.updateContact(antContact, nuevContact)) {
            System.out.println("Se ha actualizado sin problemas.");
        } else {
            System.out.println("Error: El nombre nuevo ya lo tiene otra persona.");
        }
    }

    private static void removeContact() {
        System.out.print("Nombre del contacto a borrar: ");
        String nombre = scanner.nextLine();

        Contacto contact = telefonoMovil.queryContact(nombre);
        if (contact == null) {
            System.out.println("No se puede borrar porque no existe.");
            return;
        }

        if (telefonoMovil.removeContact(contact)) {
            System.out.println("Contacto eliminado de la agenda.");
        } else {
            System.out.println("No se ha podido eliminar.");
        }
    }

    private static void addNewContact() {
        System.out.print("Dime el nombre: ");
        String nombre = scanner.nextLine();

        System.out.print("Dime el teléfono: ");
        String telefono = scanner.nextLine();

        Contacto nuevContact = Contacto.createContact(nombre, telefono);

        if (telefonoMovil.addNewContact(nuevContact)) {
            System.out.println("Contacto guardado.");
        } else {
            System.out.println("Ese nombre ya está registrado.");
        }
    }
}
